$PSDocId: Document Release 1.0 for Run-time Library Release 4.4$
getode : インターレースモードでの VSync 同期

                      Copyright(C) 1997 Sony Computer Entertainment Inc.
                                                    All Rights Reserved.


＜サンプルの解説＞
	PlayStation GPU (Graphic Processor) のインターレース時の描画に関し
	ていくつかのタイトルで以下の現象が確認されました。詳しい内容の解析
	と処置に関してご報告いたします。あてはまるモードでアプリケーション
	を設計されている方は対応をお願い申し上げます。

	[現象]
  	「インターレースシングルバッファ (縦 480 ドットモード）を使用してい
	て、かつ描画の切替えを VSync() ではなくVSyncCallback()で行なってい
	る場合に、描画の際ＯＴの始めに登録されたプリミティブの描画が奇数
	フィールドのみキャンセルされる。このため、背景画面がクリアされない
	で残像が残るとような障害が発生する。 」


	[原因]
	インターレースの場合は、偶数フィールドと奇数フィールドを 1/60[sec]
	で交互に表示します。つまり、640x480 モードであれば、y が偶数のライ
	ンと奇数のラインを交互に表示していることになります。この時、GPU は、
	表示の偶数・奇数に応じて

	・奇数フィールドを表示している時は、偶数ラインのみに描画する。
	・偶数フィールドを表示している時は、奇数ラインのみに描画する。

	のような操作を行なっており、シングルバッファでありながら、描画中の
	画面を表示しないようなメカニズムになっています。

	このためには、GPU が現在のビデオ出力が奇数フィールドか、偶数フィー
	ルドかを知る必要があります。しかしながら、V-BLNK 期間中は GPU が必
	ず偶数フィールドと認識してしまう問題が明らかになりました。

        	------------------------------------------------------
	Video   |   even   |V-BLNK|   odd   |V-BLNK|   even   |V-BLNK|
        	------------------------------------------------------
        	------------------------------------------------------
	GPU     |   even          |   odd   |          even          |
        	------------------------------------------------------

	VSyncCallback() は V-BLNK の開始時点（終了時点ではない）でコールさ
	れます。そのため、V-BLNK 期間中に描画したものは奇数フィールドにし
	か描画されません。Z ソートの関係上、通常描画の最初の部分は背景部分
	になります。このため、片側のフィールドのみ背景のクリアがされなかっ
	たり、BGの描画が行なわれないなどの現象が現れます。 


	[対策]
  	これを回避するためには、描画を V-BLNK の終了時点の直後に開始する必
	要があります。残念ながら現在の VSyncCallback() は V-BLNK の終了を検
	知することはできませんので、V-BLNK の終了を VSync(1) を使用して 
	V-BLNK 中の H-Sync の回数を数えるか、H-Sync のコールバック (RCnt2) 
	を使用して、新たにコールバックを追加するなどの措置が必要になるので
	すが、もっと確実な方法として、現在のフィールドが偶数・奇数かを判別
	する関数 GetODE() を公開いたします。

	u_long GetODE(void);  /* 0...EVEN 1...ODD */

	GetODE() はライブラリ Ver.3.7 で正式に公開されます。それ以前のライ
	ブラリで使う場合は、上記宣言を libgpu.h 等に組み込んでください。

	GetODE() の値は、現在のビデオ出力の偶数・奇数フィールドを表すので
	はなく、GPU が認識している偶数・奇数フィールドの値であることにご注
	意下さい。また、VSyncCallback() 発生直後を含めた V-BLNK 中では 
	GetODE() は必ず偶数フレームしか返しませんので、ちょっとした工夫が必
	要です。実際のコーディングにつきましては、サンプルプログラムをご参
	照ください。


	[補足]
	インターレースモードでは、奇数・偶数フィールドは、NTSC 規格の場合は
	強制的に 1/60[sec] で切り替わります。そのためこのモードをする場合は、
	全ての処理を 1/60[sec] で完結する必要があります。
	この時、処理落ちの原因が描画時間である場合（GPU ネック）は、描画を
	キャンセル（ResetGraph(1)）することで回避（もちろんポリゴンの欠けが
	生じます）できますし、CPU側が原因である場合（CPU ネック）は、CPU が
	次のＯＴを生成するまで、前のＯＴを使用して再描画を行なうことで画面の
	乱れを回避できます。これを実現するためには、VSyncCallback() 内部で
	描画命令（DrawOTag()）を発行する必要があります。サンプルプログラムで
	は CPU ネックの対策が行われています。併せてご参照ください。


＜起動方法＞ 
	>psymake	コンパイル
	>run balls	実行

＜コントローラの操作方法＞
	↑,↓       ：玉の数の増減
	L1          ：ポーズ
	SELECT      ：終了
